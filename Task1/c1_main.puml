@startuml C1_Main_Solution
!define RELATIVE_INCLUDE ../lib
!include ../lib/C4_Context.puml

LAYOUT_WITH_LEGEND()

title Контекстная диаграмма (C1) — Основное решение: Edge-first архитектура\nПлатформа мониторинга свиноводческих ферм

' === Пользователи ===
Person(operator, "Оператор фермы", "Дежурный сотрудник на ферме.\nПолучает уведомления о\nнештатных ситуациях,\nуправляет оборудованием")
Person(manager, "Управляющий / Директор", "Контролирует состояние\nвсех ферм удалённо\nчерез веб-портал")
Person(vet, "Ветеринар", "Отслеживает здоровье\nживотных, получает\nоповещения о болезнях")

' === Разрабатываемая система ===
Enterprise_Boundary(platform, "Платформа мониторинга скота") {

    System(central, "Центральный сервер мониторинга", "Агрегация данных со всех ферм,\nуправление пользователями,\nотчётность, аналитика,\nAPI для веб/мобильных приложений,\nхранение истории и метрик")

    System(farm_agent, "Агент фермы (Edge AI)", "Локальная система на каждой ферме.\nВидеоаналитика на edge-устройствах,\nуправление кормушками/поилками,\nлокальное хранение данных,\nавтономная работа без интернета,\nоповещение оператора на месте")
}

' === Внешние системы ===
System_Ext(agrotech, "АгроПром Х\n(существующая платформа)", "ERP (1С:Агро), Data Warehouse,\nBI-система, IoT-платформа")

System_Ext(notifications, "Система уведомлений", "SMS-шлюз, Push-уведомления,\nEmail, мессенджеры")

System_Ext(iot_devices, "IoT-оборудование фермы", "Видеокамеры (вкл. ночные),\nдатчики среды, кормушки\nи поилки разных производителей,\nсистемы фильтрации воды")

System_Ext(ai_model, "Нейросетевая модель\n(от партнёров)", "Предобученная модель для\nраспознавания поведения животных,\nподсчёта поголовья,\nоценки состояния здоровья")

' === Связи пользователей ===
Rel(operator, farm_agent, "Получает уведомления,\nуправляет оборудованием", "Локальный веб-интерфейс / мобильное приложение")
Rel(manager, central, "Мониторинг всех ферм,\nотчёты, управление", "Веб-портал / REST API")
Rel(vet, central, "Просмотр состояния\nживотных, уведомления", "Веб-портал / мобильное приложение")

' === Связи между системами ===
Rel(farm_agent, central, "Синхронизация данных\n(допустима задержка до 10 мин)", "REST API / Message Queue")
Rel(central, agrotech, "Передача бизнес-данных,\nметрик, отчётов", "REST API / ETL")
Rel(central, notifications, "Отправка уведомлений\nуправляющим и ветеринарам", "SMTP / SMS API / Push")
Rel(farm_agent, notifications, "Локальные уведомления\nоператору при офлайне", "SMS / Локальная сеть")
Rel(farm_agent, iot_devices, "Сбор данных с камер и датчиков,\nуправление кормушками/поилками", "RTSP / MQTT / Modbus / REST API")
Rel(farm_agent, ai_model, "Запуск видеоаналитики\nна edge-устройствах", "Встроенная модель (ONNX/TensorRT)")

@enduml
