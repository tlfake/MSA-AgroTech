### **Название задачи:** Сравнительный анализ и выбор архитектурного решения — MVP платформы мониторинга свиноводческих ферм
### **Автор:** Архитектор
### **Дата:** 18.02.2026

---

### **Контекст**

По результатам заданий 1–3 проработаны два архитектурных решения:
- **Решение А (Edge-first)** — видеоаналитика выполняется локально на edge-серверах каждой фермы.
- **Решение Б (Centralised)** — видеоаналитика выполняется в централизованной облачной платформе.

Для принятия окончательного решения необходимо провести сравнительный анализ по значимым критериям.

---

### **Критерии сравнения**

Критерии сформированы на основе функциональных и нефункциональных требований, а также бизнес-контекста (MVP, планируемый SaaS).

| **№** | **Критерий** | **Вес** | **Описание** |
| :-: | :- | :-: | :- |
| 1 | Соответствие NFR: автономная работа без интернета | ⭐⭐⭐ | Ферма должна функционировать полноценно при отсутствии связи |
| 2 | Соответствие NFR: время оповещения < 5 секунд | ⭐⭐⭐ | Критичный SLA для безопасности животных |
| 3 | Соответствие NFR: реалтайм аналитика (мс) | ⭐⭐⭐ | Требование к латентности видеоаналитики |
| 4 | Стартовые затраты (CAPEX) | ⭐⭐ | Бюджет на запуск MVP |
| 5 | Операционные затраты (OPEX) | ⭐⭐ | Постоянные затраты на поддержку и масштабирование |
| 6 | Отказоустойчивость (99,95%) | ⭐⭐⭐ | Доступность системы |
| 7 | Масштабируемость (SaaS-потенциал) | ⭐⭐ | Возможность предложить как SaaS для других компаний |
| 8 | Простота разработки и эксплуатации | ⭐⭐ | Скорость разработки MVP, сложность DevOps |
| 9 | Расширяемость без изменения существующего кода | ⭐⭐ | Добавление новых типов датчиков, моделей, ферм |
| 10 | Безопасность и конфиденциальность данных | ⭐⭐ | Видеоданные с животными, доступ третьих сторон |
| 11 | Требования к каналам связи | ⭐⭐⭐ | Реализуемость при нестабильном WiFi и 4G на удалённых фермах |

Веса: ⭐⭐⭐ — критичный, ⭐⭐ — важный, ⭐ — желательный.

---

### **Анализ вариантов по критериям**

#### Шкала оценки: 1 (плохо) — 5 (отлично)

| **№** | **Критерий** | **Вес** | **Решение А (Edge-first)** | **Оценка А** | **Решение Б (Centralised)** | **Оценка Б** |
| :-: | :- | :-: | :- | :-: | :- | :-: |
| 1 | Автономная работа без интернета | ⭐⭐⭐ | Ферма полностью автономна: видеоаналитика, алерты, управление оборудованием — всё работает локально независимо от связи | **5** | Без интернета — нет видеоаналитики, нет алертов о критических событиях. Только минимальный офлайн-нотифайер (SMS оператору через GSM-модем) | **1** |
| 2 | Время оповещения < 5 сек | ⭐⭐⭐ | Цикл: инференс (50–100 мс) + Event Processor (50 мс) + Local Notifier (<100 мс) = ~300 мс. Гарантированно выполняется с запасом | **5** | Цикл: передача видео (500 мс–3 сек) + инференс в облаке (100–500 мс) + возврат алерта (500 мс–2 сек) = 1,1–5,5+ сек. При нестабильной сети — нарушение SLA | **2** |
| 3 | Реалтайм аналитика (мс) | ⭐⭐⭐ | TensorRT на локальном GPU: инференс одного кадра 10–50 мс, FPS ≥ 15. Полностью локально, без сетевой задержки | **5** | Triton + A100: инференс 5–15 мс, но сетевая задержка (RTSP → облако → результат): 200–2000 мс в зависимости от канала. Реалтайм в мс невозможен при передаче через WAN | **2** |
| 4 | Стартовые затраты (CAPEX) | ⭐⭐ | Edge-сервер с GPU для MVP (2–5 ферм): NVIDIA Jetson Orin ~$500 × 5 = ~$2 500. Плюс центральный сервер. Умеренно | **4** | Нет затрат на edge-GPU. Но нужны облачные GPU-серверы (A100 ~$10k/мес аренда) или собственный ЦОД с GPU (>$50k). CAPEX выше при собственной инфраструктуре | **3** |
| 5 | Операционные затраты (OPEX) | ⭐⭐ | При 150 фермах: замена/обслуживание edge-серверов. Но экономия на облаке и каналах связи (нет потоков видео в центр). При росте GPU не добавляются пропорционально | **4** | Облачные GPU: A100 ~$3–10/час × 24/7 на кластер = $50–500k/год при 150 фермах. OPEX растёт линейно с числом ферм. Высокие затраты на широкополосные каналы | **2** |
| 6 | Отказоустойчивость (99,95%) | ⭐⭐⭐ | Ферма — самодостаточная единица. Отказ центрального сервера не влияет на локальную работу. Нужен горячий резерв edge-сервера на каждой ферме | **4** | Центральная платформа — единственная точка обработки. Требует geo-redundant HA-кластера из нескольких ЦОД. Реализуемо, но сложно и дорого. При отказе — все фермы без аналитики | **3** |
| 7 | Масштабируемость (SaaS) | ⭐⭐ | Добавление новой фермы = поставить edge-сервер. Горизонтальный рост без дополнительной нагрузки на центр. SaaS-модель: продаём «ферма-агент» как устройство + подписку | **4** | Легко добавить новую ферму без оборудования у клиента. Центральный кластер масштабируется горизонтально. Классическая SaaS-модель. Но при 1000+ ферм OPEX на GPU становится критичным | **4** |
| 8 | Простота разработки и эксплуатации | ⭐⭐ | Сложность: управление fleet edge-устройств (OTA, мониторинг, удалённый доступ). Но меньше сетевых зависимостей, проще локальный дебаггинг | **3** | Классическая облачная разработка, DevOps проще (один кластер). Сложности: стриминг видео с ферм, Kafka, Triton. Более знакомый стек для большинства команд | **3** |
| 9 | Расширяемость | ⭐⭐ | Плагинная архитектура адаптеров устройств на ферме. Добавление новых устройств — новый адаптер. Новые ML-модели — OTA-обновление. Оба решения симметричны по расширяемости | **4** | Централизованный Model Registry упрощает деплой новых моделей. Добавление новых типов датчиков — новый микросервис на центральной платформе. Хорошая расширяемость | **4** |
| 10 | Безопасность и конфиденциальность | ⭐⭐ | Видеоданные хранятся и обрабатываются локально. В центр уходят только события и метрики (не видео). Минимальная поверхность атаки в части сырых данных | **5** | Видеопотоки со всех ферм передаются в облако и хранятся централизованно. Высокие требования к защите, сертификации, шифрованию хранилища. Риск утечки | **3** |
| 11 | Требования к каналам связи | ⭐⭐⭐ | Синхронизация только агрегированных данных (события, метрики): 1–10 Кбит/с на ферму. Работает даже на GPRS. Идеально для удалённых ферм | **5** | Видеопотоки H.264 с нескольких камер: 10–50 Мбит/с на ферму. При нестабильном WiFi и 4G — нереалистично. Требует выделенного широкополосного канала (оптика) | **1** |

#### Итоговые взвешенные оценки

| | **Решение А (Edge-first)** | **Решение Б (Centralised)** |
| :- | :-: | :-: |
| Сумма по критичным критериям (1, 2, 3, 6, 11) × 3 | 5+5+5+4+5 = **24** × 3 = **72** | 1+2+2+3+1 = **9** × 3 = **27** |
| Сумма по важным критериям (4, 5, 7, 8, 9, 10) × 2 | 4+4+4+3+4+5 = **24** × 2 = **48** | 3+2+4+3+4+3 = **19** × 2 = **38** |
| **Итого** | **120** | **65** |

---

### **Резюме и рекомендация**

**Рекомендую Решение А — Edge-first архитектуру.**

#### Обоснование

Ключевые требования системы — автономная работа без интернета, время оповещения < 5 секунд и реалтайм видеоаналитика — **не могут быть выполнены** при централизованной архитектуре в условиях, описанных в задании: нестабильный WiFi, удалённые фермы, требование автономности.

Решение Б нарушает **3 из 5 критичных требований** уже на уровне архитектурного ограничения, а не риска. Это делает его неприемлемым для данной задачи.

Решение А имеет недостатки (CAPEX на edge-GPU, сложность fleet management), но все они **управляемы** и не нарушают функциональных требований:

| **Недостаток решения А** | **Управляющий фактор** |
| :- | :- |
| CAPEX на edge-GPU | Для MVP (2–5 ферм) — около $2–5k. Окупается за счёт отсутствия OPEX на облачные GPU и широкополосные каналы |
| Fleet Management | k3s + Ansible + staged rollout — зрелые инструменты с хорошей документацией |
| Локальные аппаратные отказы | Горячий резерв (второй edge-сервер), автодиагностика и алертинг |
| OTA-обновления моделей | Постепенный rollout с автооткатом; отработать на MVP |

#### Если бизнес-требования изменятся

Решение Б становится предпочтительным **только** при одновременном выполнении условий:
- требование автономности убрано;
- ферма имеет стабильный выделенный канал ≥ 20 Мбит/с;
- SLA по времени оповещения смягчён до 30+ секунд;
- бизнес делает ставку на чисто SaaS-модель без поставки оборудования.

В текущем контексте MVP на свиноводческих фермах с нестабильной связью **рекомендуется Решение А**.

---

### **Компромиссы принятого решения**

| **Компромисс** | **Описание** | **Последствие** |
| :- | :- | :- |
| CAPEX > OPEX | Платим сразу за оборудование, а не помесячно | Выше входной барьер, ниже долгосрочные затраты |
| Усложнённый DevOps | Fleet management вместо одного кластера | Нужна отдельная дисциплина управления edge-устройствами с первого дня |
| OTA сложнее облака | Обновления раскатываются последовательно, не мгновенно | Старые версии модели могут работать несколько дней до полного раскатывания; допустимо |
| Ограниченный SaaS без поставки железа | Клиент должен получить edge-сервер | Либо поставляем «ферма-агент» как устройство, либо поддерживаем партнёрскую сеть поставщиков |
| Видео не хранится централизованно | Видеозаписи инцидентов — на локальном хранилище фермы | При необходимости расследования — нужен удалённый доступ к ферме или запуск механизма выгрузки по запросу |
